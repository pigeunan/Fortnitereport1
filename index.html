<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>클릭 챌린지 — 20초 안에 최대한 많이 클릭!</title>
<style>
  :root{--bg:#071028;--card:#0e1630;--accent:#ffb84d;--muted:#96a3b6}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,"Apple SD Gothic Neo",system-ui;
       background:linear-gradient(180deg,var(--bg),#02040a);
       color:#e7f0ff;min-height:100vh;display:flex;
       align-items:center;justify-content:center;padding:28px}
  .container{width:980px;max-width:96%;
             display:grid;grid-template-columns:1fr 320px;
             gap:18px;align-items:start}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),
                                   rgba(255,255,255,0.01));
        border-radius:14px;padding:24px;
        box-shadow:0 18px 50px rgba(0,0,0,.6)}
  h1{margin:0 0 8px;font-size:22px}
  p.lead{margin:0 0 12px;color:var(--muted)}
  .panel{background:rgba(255,255,255,0.02);
         border-radius:12px;padding:18px;text-align:center}
  .bigbtn{display:inline-block;padding:18px 26px;border-radius:14px;
          background:var(--accent);color:#111;font-weight:900;
          border:0;font-size:20px;cursor:pointer}
  .count{font-size:48px;font-weight:900;margin-top:10px}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}
  .small{font-size:13px;color:var(--muted)}
  .overlay{position:fixed;inset:0;background:#000;display:none;
           align-items:center;justify-content:center;z-index:9999}
  .overlay.show{display:flex}
  .vbox{position:fixed;inset:0;background:#000}
  video{position:absolute;inset:0;width:100vw;height:100vh;
        object-fit:cover;display:block}
  .controls{position:fixed;left:50%;bottom:26px;transform:translateX(-50%);
            display:flex;gap:10px;z-index:10001}
  .btn{border:0;border-radius:12px;padding:12px 16px;
       font-weight:700;cursor:pointer}
  .ghost{background:rgba(255,255,255,0.06);color:#e7eef8}
  .primary{background:var(--accent);color:#150f00}
  .notice{position:fixed;right:14px;top:14px;
          background:rgba(0,0,0,0.45);padding:8px 12px;
          border-radius:10px;color:#fff;font-weight:700;z-index:10001}
  .pulse{animation:pop 0.15s ease-out}
  @keyframes pop{0%{transform:scale(1)}50%{transform:scale(0.96)}100%{transform:scale(1)}}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>클릭 챌린지 — 20초 안에 최대한 많이 누르세요!</h1>
      <p class="lead">손가락 스피드 테스트 ㄱㄱ</p>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1">
          <ul style="margin:8px 0 0 18px;color:var(--muted)">
            <li>제한 시간: <strong>20초</strong></li>
            <li>목표 클릭 수: <strong id="targetLabel">20</strong> 회</li>
            <li>누가 더 빨리 연타하나 겨뤄보세요</li>
          </ul>
        </div>

        <div style="width:320px">
          <div class="panel">
            <div style="font-size:15px;font-weight:800">남은 시간</div>
            <div class="count" id="timeDisplay">20</div>
            <div style="height:12px"></div>
            <button id="clickBtn" class="bigbtn">여기를 연타! 🔴</button>
            <div class="meta">클릭 수: <span id="clickCount">0</span></div>
            <div class="meta">목표: <span id="targetCount">20</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 오버레이 -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="vbox">
      <video id="vid" playsinline preload="auto" muted>
        <source src="https://github.com/pigeunan/myvideo/raw/refs/heads/main/cm-chat-media-video-1016a9fde-00c2-5fca-b544-014ee5d7809422100_1.mp4" type="video/mp4">
      </video>
      <div class="controls" id="overlayControls" style="display:none">
        <button class="btn primary" id="forceUnmute">소리 켜기 🔊</button>
        <button class="btn ghost" id="closeOverlay">닫기 ✕</button>
      </div>
    </div>
  </div>

<script>
  const TIME_LIMIT = 20; // 20초
  const TARGET = 20;

  const timeDisplay = document.getElementById('timeDisplay');
  const clickBtn = document.getElementById('clickBtn');
  const clickCountEl = document.getElementById('clickCount');
  const targetCountEl = document.getElementById('targetCount');
  const targetLabel = document.getElementById('targetLabel');

  const overlay = document.getElementById('overlay');
  const vid = document.getElementById('vid');
  const overlayControls = document.getElementById('overlayControls');
  const forceUnmute = document.getElementById('forceUnmute');
  const closeOverlay = document.getElementById('closeOverlay');

  targetCountEl.textContent = TARGET;
  targetLabel.textContent = TARGET;

  let clicks = 0;
  let timeLeft = TIME_LIMIT;
  let intervalId = null;
  let challengeActive = false;
  let triggered = false;

  function startChallenge(){
    if (challengeActive) return;
    challengeActive = true;
    timeDisplay.textContent = timeLeft;
    intervalId = setInterval(()=> {
      timeLeft--;
      timeDisplay.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(intervalId);
        endChallenge();
      }
    }, 1000);
  }

  function handleClick(){
    clickBtn.classList.add('pulse');
    setTimeout(()=> clickBtn.classList.remove('pulse'), 140);
    if (!challengeActive) startChallenge();
    clicks++;
    clickCountEl.textContent = clicks;
    if (!triggered && clicks >= TARGET) {
      triggered = true;
      showOverlay(true);
    }
  }
  clickBtn.addEventListener('pointerdown', handleClick, {passive:true});

  // 끝난 뒤 4초 지연
  async function endChallenge(){
    if (triggered) return;
    setTimeout(() => {
      showOverlay(false);
    }, 4000); // 4초 뒤
  }

  async function showOverlay(unmuteNow){
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    try{ if (overlay.requestFullscreen) await overlay.requestFullscreen(); }catch(e){}
    try {
      if (unmuteNow) {
        vid.muted = false;
        vid.volume = 1.0;
        await vid.play();
      } else {
        vid.muted = true;
        await vid.play();
      }
      overlayControls.style.display = 'flex';
    } catch(err) {
      overlayControls.style.display = 'flex';
    }
  }

  forceUnmute.addEventListener('click', async () => {
    vid.muted = false;
    vid.volume = 1.0;
    await vid.play();
  });

  closeOverlay.addEventListener('click', ()=> {
    try{ vid.pause(); vid.currentTime = 0; }catch(e){}
    if (document.fullscreenElement) document.exitFullscreen();
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
  });

  document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape' && overlay.getAttribute('aria-hidden')==='false'){
      closeOverlay.click();
    }
  });

  // 자동으로 챌린지 시작
  startChallenge();
</script>
</body>
</html>